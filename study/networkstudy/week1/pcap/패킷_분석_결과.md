# 패킷 캡처 분석 결과

## 📋 개요
- **분석 일시**: 2026-01-02
- **분석 파일 수**: 3개 (arp.pcap, l3_trace.pcap, capture.pcap)
- **캡처 환경**: Docker 네트워크 (172.17.0.0/16)

---

## 1. arp.pcap 분석

### 📊 기본 정보
- **파일 크기**: 1,184 bytes
- **링크 타입**: EN10MB (Ethernet)
- **총 패킷 수**: 20개
- **캡처 시간**: 22:22:49 ~ 22:22:55

### 🔍 주요 내용
ARP (Address Resolution Protocol) 요청 및 응답 패킷들을 캡처한 파일입니다.

#### 네트워크 구성
- **요청자**: 172.17.0.3 (MAC: e6:21:c1:04:f0:85)
- **게이트웨이**: 172.17.0.1 (MAC: 6e:45:6c:9a:b6:66)

#### 패킷 패턴
```
172.17.0.3 → 172.17.0.1: ARP Request "Who has 172.17.0.1?"
172.17.0.3 → 172.17.0.1: ARP Request (중복)
172.17.0.1 → 172.17.0.3: ARP Reply "172.17.0.1 is at 6e:45:6c:9a:b6:66"
```

#### 특이사항
1. **중복 ARP 요청**: 각 ARP 요청이 2번씩 전송됨 (신뢰성 확보)
2. **양방향 통신**: 
   - 대부분 172.17.0.3 → 172.17.0.1 요청
   - 마지막에 172.17.0.1 → 172.17.0.3 역방향 요청 발생
3. **주기적 요청**: 약 1~2초 간격으로 반복적인 ARP 요청

### 💡 학습 포인트
- ARP는 IP 주소를 MAC 주소로 변환하는 L2 프로토콜
- 네트워크 통신 시작 전 필수적으로 발생
- ARP 캐시 타임아웃으로 인한 주기적 갱신

---

## 2. l3_trace.pcap 분석

### 📊 기본 정보
- **파일 크기**: 2,866 bytes
- **링크 타입**: EN10MB (Ethernet)
- **총 패킷 수**: 40개
- **캡처 시간**: 22:29:28 ~ 22:30:13

### 🔍 주요 내용
L3 (Network Layer) 트레이싱 - DNS, Traceroute, ICMP 패킷 분석

#### 1. DNS 쿼리 (22:29:28.147)
```
172.17.0.4:53629 → 192.168.65.7:53
- A 레코드 쿼리: google.com (ID: 41384)
- AAAA 레코드 쿼리: google.com (ID: 41551)

응답:
- AAAA: 응답 없음 (IPv6 주소 없음)
- A: 142.250.206.238 (google.com의 IPv4 주소)
```

#### 2. Traceroute 시도 (22:29:28.166 ~ 22:30:13)
```
목적지: 142.250.206.238 (google.com)
소스 포트: 37333
목적지 포트: 33435부터 순차 증가

TTL=1 패킷들:
- 172.17.0.4 → 142.250.206.238 (UDP)
- 172.17.0.1 → 172.17.0.4 (ICMP Time Exceeded)
→ 첫 번째 홉: 172.17.0.1 (Docker 게이트웨이)

TTL=2, 3, 4, 5 패킷들:
- 응답 없음 (타임아웃)
→ 외부 라우터들이 ICMP 응답을 차단
```

#### 3. ICMP Ping (22:29:39 ~ 22:29:41)
```
172.17.0.4 → 8.8.8.8 (Google DNS)
- Echo Request (id=7, seq=1,2,3)
- Echo Reply 정상 수신
- RTT: 약 40ms
```

#### 4. 역방향 DNS 조회
```
172.17.0.4 → 192.168.65.7:53
PTR 쿼리: 1.0.17.172.in-addr.arpa
응답: NXDomain (레코드 없음)
```

### 💡 학습 포인트
- **Traceroute 원리**: TTL을 1부터 증가시키며 각 홉의 라우터를 발견
- **ICMP Time Exceeded**: TTL=0이 되면 라우터가 보내는 응답
- **DNS A/AAAA 레코드**: IPv4/IPv6 주소 조회
- **PTR 레코드**: IP 주소의 역방향 DNS 조회

---

## 3. capture.pcap 분석

### 📊 기본 정보
- **파일 크기**: 9,903 bytes
- **링크 타입**: LINUX_SLL2 (Linux cooked v2)
- **총 패킷 수**: 66개
- **캡처 시간**: 22:12:53 ~ 22:12:58
- **인터페이스**: en2

### 🔍 주요 내용
HTTP 웹 서버 (nginx) 트래픽 캡처 - TCP 3-way handshake부터 HTTP 요청/응답까지

#### 네트워크 구성
- **클라이언트**: 192.168.65.1 (호스트 머신)
- **서버**: 172.17.0.3:80 (Docker 컨테이너 - nginx)

#### HTTP 트랜잭션 1: 정상 요청 (22:12:53.482 ~ 22:12:53.489)

##### 1단계: TCP 3-Way Handshake
```
[SYN] 192.168.65.1:57783 → 172.17.0.3:80
  - seq=2893842077, win=65408, MSS=65495

[SYN-ACK] 172.17.0.3:80 → 192.168.65.1:57783
  - seq=1726085983, ack=2893842078, win=65483

[ACK] 192.168.65.1:57783 → 172.17.0.3:80
  - ack=1726085984
```

##### 2단계: HTTP 요청
```http
GET / HTTP/1.1
Host: localhost:8080
User-Agent: curl/8.7.1
Accept: */*
```

##### 3단계: HTTP 응답
```http
HTTP/1.1 200 OK
Server: nginx/1.29.1
Date: Fri, 02 Jan 2026 13:12:53 GMT
Content-Type: text/html
Content-Length: 615
Last-Modified: Wed, 13 Aug 2025 14:33:41 GMT
Connection: keep-alive
ETag: "689ca245-267"
Accept-Ranges: bytes

[HTML 본문 615 bytes]
```

##### 4단계: TCP 연결 종료 (4-Way Handshake)
```
[FIN-ACK] 클라이언트 → 서버
[FIN-ACK] 서버 → 클라이언트
[ACK] 클라이언트 → 서버
```

#### HTTP 트랜잭션 2: 404 에러 (22:12:53.617 ~ 22:12:53.622)

##### HTTP 요청
```http
GET /error-test HTTP/1.1
Host: localhost:8080
User-Agent: curl/8.7.1
Accept: */*
```

##### HTTP 응답
```http
HTTP/1.1 404 Not Found
Server: nginx/1.29.1
Date: Fri, 02 Jan 2026 13:12:53 GMT
Content-Type: text/html
Content-Length: 153
Connection: keep-alive

<html>
<head><title>404 Not Found</title></head>
<body>
<center><h1>404 Not Found</h1></center>
<hr><center>nginx/1.29.1</center>
</body>
</html>
```

#### 추가 트랜잭션들
파일에는 총 5개의 HTTP 트랜잭션이 포함되어 있으며, 모두 유사한 패턴을 따릅니다:
1. TCP 연결 수립
2. HTTP 요청
3. HTTP 응답
4. TCP 연결 종료

### 📈 TCP 특성 분석

#### Window Size
- 클라이언트: 65408 → 4096 (동적 조정)
- 서버: 65483 → 512

#### TCP Options
- **MSS (Maximum Segment Size)**: 65495 bytes
- **Window Scale**: 7 (실제 윈도우 크기 = advertised × 2^7)
- **Timestamps**: 활성화 (RTT 측정 및 PAWS)

#### 체크섬
- 모든 패킷에서 체크섬 오프로드 확인됨
  - `cksum 0x0000 (incorrect → 0x...)`
  - NIC에서 하드웨어 체크섬 계산

### 💡 학습 포인트

#### TCP 연결 관리
1. **3-Way Handshake**: SYN → SYN-ACK → ACK
2. **4-Way Handshake**: FIN → ACK, FIN → ACK
3. **Delayed ACK**: 여러 세그먼트를 하나의 ACK로 확인

#### HTTP 프로토콜
1. **요청-응답 모델**: 클라이언트가 요청, 서버가 응답
2. **Keep-Alive**: 연결 재사용 가능 (하지만 이 캡처에서는 즉시 종료)
3. **상태 코드**: 200 OK, 404 Not Found

#### 네트워크 최적화
1. **Large MSS**: 로컬 네트워크에서 65495 bytes (거의 최대값)
2. **Window Scaling**: 대용량 데이터 전송 지원
3. **Checksum Offload**: CPU 부하 감소

---

## 🎯 종합 분석

### 캡처된 프로토콜 계층
```
L2 (Data Link): Ethernet, ARP
L3 (Network):   IP, ICMP
L4 (Transport): TCP, UDP
L7 (Application): HTTP, DNS
```

### 네트워크 토폴로지
```
[Host: 192.168.65.1]
        |
        | (en2 interface)
        |
[Docker Bridge: 172.17.0.1]
        |
        +-- [Container 1: 172.17.0.3] - nginx 웹 서버
        +-- [Container 2: 172.17.0.4] - 네트워크 테스트
```

### 주요 발견사항

1. **ARP 동작**
   - 통신 전 MAC 주소 확인 필수
   - 중복 요청으로 신뢰성 확보

2. **DNS 해석**
   - A/AAAA 레코드 동시 조회 (IPv4/IPv6)
   - PTR 레코드로 역방향 조회

3. **Traceroute 메커니즘**
   - TTL 기반 경로 추적
   - ICMP Time Exceeded 활용

4. **HTTP over TCP**
   - 완전한 연결 수립/종료 과정
   - 신뢰성 있는 데이터 전송
   - 체크섬 오프로드로 성능 최적화

### 실무 적용 포인트

1. **디버깅**: 네트워크 문제 발생 시 각 계층별 분석
2. **성능 최적화**: Window Size, MSS 튜닝
3. **보안**: 비정상 패킷 패턴 탐지
4. **모니터링**: 트래픽 패턴 분석 및 이상 탐지

---

## 📚 참고 명령어

### 기본 분석
```bash
# 전체 패킷 보기
tcpdump -r file.pcap -n -v

# 요약 정보만
tcpdump -r file.pcap -n -q

# 특정 프로토콜만
tcpdump -r file.pcap -n 'tcp'
tcpdump -r file.pcap -n 'udp'
tcpdump -r file.pcap -n 'icmp'

# 특정 호스트/포트
tcpdump -r file.pcap -n 'host 172.17.0.3'
tcpdump -r file.pcap -n 'port 80'
```

### 고급 분석
```bash
# HTTP 요청만 추출
tcpdump -r file.pcap -n -A 'tcp port 80'

# 패킷 카운트
tcpdump -r file.pcap -n | wc -l

# 16진수 덤프
tcpdump -r file.pcap -n -X
```

---

## 🔗 관련 RFC 문서

- **RFC 826**: ARP (Address Resolution Protocol)
- **RFC 791**: IP (Internet Protocol)
- **RFC 792**: ICMP (Internet Control Message Protocol)
- **RFC 793**: TCP (Transmission Control Protocol)
- **RFC 1035**: DNS (Domain Name System)
- **RFC 2616**: HTTP/1.1
- **RFC 7230**: HTTP/1.1 Message Syntax and Routing

---

*분석 도구: tcpdump*  
*분석 환경: macOS*
